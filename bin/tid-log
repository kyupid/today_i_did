#!/bin/bash
# tmux hookì—ì„œ í˜¸ì¶œë¨ - ì„¸ì…˜ attach ì‹œ ntfyë¡œ ì „ì†¡

SCRIPT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
source "$SCRIPT_DIR/config.sh"

SESSION_NAME=$(tmux display-message -p '#S')
TIME=$(date '+%H:%M')
DATE=$(date '+%Y-%m-%d')

# ë¡œì»¬ ë¡œê·¸ ì €ìž¥
mkdir -p "$SCRIPT_DIR/logs"
echo "$TIME - $SESSION_NAME" >> "$SCRIPT_DIR/logs/$DATE.log"

# ntfy ì „ì†¡ (í† í”½ì´ ì„¤ì •ëœ ê²½ìš°ë§Œ)
if [[ "$NTFY_TOPIC" != "YOUR_TOPIC_HERE" && "$NTFY_TOPIC" != "your-random-topic-name-here" && -n "$NTFY_TOPIC" ]]; then
    curl -s -d "ðŸ”§ $TIME - $SESSION_NAME" "https://ntfy.sh/$NTFY_TOPIC" > /dev/null 2>&1 &
fi
